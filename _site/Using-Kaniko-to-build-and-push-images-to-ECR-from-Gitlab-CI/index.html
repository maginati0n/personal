<!DOCTYPE html> <html lang="en-US"> <head prefix="og: http://ogp.me/ns#"> <meta charset="UTF-8" /> <meta http-equiv="X-UA-Compatible" content="ie=edge" /> <meta name="viewport" content="width=device-width, initial-scale=1.0" /> <meta name="mobile-web-app-capable" content="yes" /> <meta name="apple-mobile-web-app-capable" content="yes" /> <meta name="application-name" content="Hello There!" /> <meta name="apple-mobile-web-app-status-bar-style" content="#fff" /> <meta name="apple-mobile-web-app-title" content="Hello There!" /> <title> Using Kaniko To Build And Push Images To Ecr From Gitlab Ci - Hello There! </title> <link rel="alternate" href="http://localhost:4000/Using-Kaniko-to-build-and-push-images-to-ECR-from-Gitlab-CI/" hreflang="en-US" /> <link rel="canonical" href="http://localhost:4000/Using-Kaniko-to-build-and-push-images-to-ECR-from-Gitlab-CI/" /> <meta name="description" content="Im writing in Bahasa about web technology and experience as a journal for documentation things that he learned, meet him @github." /> <meta name="referrer" content="no-referrer-when-downgrade" /> <meta property="fb:app_id" content="" /> <meta property="og:site_name" content="Using Kaniko To Build And Push Images To Ecr From Gitlab Ci | Dimas Tri Sasongko" /> <meta property="og:title" content="Using Kaniko To Build And Push Images To Ecr From Gitlab Ci | Dimas Tri Sasongko" /> <meta property="og:type" content="website" /> <meta property="og:url" content="http://localhost:4000/Using-Kaniko-to-build-and-push-images-to-ECR-from-Gitlab-CI/" /> <meta property="og:description" content="Im writing in Bahasa about web technology and experience as a journal for documentation things that he learned, meet him @github." /> <meta property="og:image" content="http://localhost:4000/assets/img/ogp.png" /> <meta property="og:image:width" content="640" /> <meta property="og:image:height" content="640" /> <meta name="twitter:card" content="summary" /> <meta name="twitter:title" content="Using Kaniko To Build And Push Images To Ecr From Gitlab Ci | dimastrisngko" /> <meta name="twitter:url" content="http://localhost:4000/Using-Kaniko-to-build-and-push-images-to-ECR-from-Gitlab-CI/" /> <meta name="twitter:site" content="@dimastrisngko" /> <meta name="twitter:creator" content="@dimastrisngko" /> <meta name="twitter:description" content="Im writing in Bahasa about web technology and experience as a journal for documentation things that he learned, meet him @github." /> <meta name="twitter:image" content="http://localhost:4000/assets/img/ogp.png" /> <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Hello There!" /> <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicons/apple-touch-icon.png" /> <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png" /> <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png" /> <link rel="manifest" href="/assets/favicons/site.webmanifest" /> <link rel="mask-icon" href="/assets/favicons/safari-pinned-tab.svg" color="#5bbad5" /> <meta name="apple-mobile-web-app-title" content="Jekyll Klise" /> <meta name="application-name" content="Jekyll Klise" /> <meta name="msapplication-TileColor" content="#da532c" /> <meta name="theme-color" content="#2c2c2c" /> <link rel="stylesheet" href="/assets/css/style.css" /> </head> <body data-theme="dark" class="notransition"> <script> const body = document.body; const data = body.getAttribute("data-theme"); const initTheme = (state) => { if (state === "dark") { body.setAttribute("data-theme", "dark"); } else if (state === "light") { body.removeAttribute("data-theme"); } else { localStorage.setItem("theme", data); } }; initTheme(localStorage.getItem("theme")); setTimeout(() => body.classList.remove("notransition"), 75); </script> <div class="navbar" role="navigation"> <nav class="menu"> <input type="checkbox" id="menu-trigger" class="menu-trigger" /> <label for="menu-trigger"> <span class="menu-icon"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <path d="M64,384H448V341.33H64Zm0-106.67H448V234.67H64ZM64,128v42.67H448V128Z" /> </svg> </span> </label> <a id="mode"> <svg class="mode-sunny" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <title>LIGHT</title> <line x1="256" y1="48" x2="256" y2="96" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="256" y1="416" x2="256" y2="464" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="108.92" x2="369.14" y2="142.86" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="369.14" x2="108.92" y2="403.08" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="464" y1="256" x2="416" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="96" y1="256" x2="48" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="403.08" x2="369.14" y2="369.14" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="142.86" x2="108.92" y2="108.92" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <circle cx="256" cy="256" r="80" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> </svg> <svg class="mode-moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <title>DARK</title> <line x1="256" y1="48" x2="256" y2="96" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="256" y1="416" x2="256" y2="464" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="108.92" x2="369.14" y2="142.86" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="369.14" x2="108.92" y2="403.08" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="464" y1="256" x2="416" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="96" y1="256" x2="48" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="403.08" x2="369.14" y2="369.14" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="142.86" x2="108.92" y2="108.92" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <circle cx="256" cy="256" r="80" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> </svg> </a> <div class="trigger"> <div class="trigger-container"><a class="menu-link" href="/">home</a><a class="menu-link" href="/archive/">archive</a><a class="menu-link" href="/about/">about</a><a class="menu-link rss" href="/feed.xml"> <svg xmlns="http://www.w3.org/2000/svg" width="17" height="17" viewBox="0 0 512 512" fill="#ED812E" > <title>RSS</title> <path d="M108.56,342.78a60.34,60.34,0,1,0,60.56,60.44A60.63,60.63,0,0,0,108.56,342.78Z" /> <path d="M48,186.67v86.55c52,0,101.94,15.39,138.67,52.11s52,86.56,52,138.67h86.66C325.33,312.44,199.67,186.67,48,186.67Z" /> <path d="M48,48v86.56c185.25,0,329.22,144.08,329.22,329.44H464C464,234.66,277.67,48,48,48Z" /> </svg> </a> </div> </div> </nav> </div> <div class="wrapper post"> <main class="page-content" aria-label="Content"> <article itemscope itemtype="https://schema.org/BlogPosting"> <header class="header"> <h1 class="header-title" itemprop="headline">Using Kaniko To Build And Push Images To Ecr From Gitlab Ci</h1> <div class="post-meta"> <time datetime="2023-04-09T00:00:00+07:00" itemprop="datePublished"> Apr 09, 2023 </time> <span itemprop="author" itemscope itemtype="https://schema.org/Person"> <span itemprop="name">Dimas Tri Sasongko</span> </span> <time hidden datetime="" itemprop="dateModified"> Apr 09, 2023 </time> <span hidden itemprop="publisher" itemtype="Person">Dimas Tri Sasongko</span> <span hidden itemprop="image"></span> <span hidden itemprop="mainEntityOfPage"><h1 id="using-kaniko-to-build-and-push-images-to-ecr-aws-from-gitlab-ci">Using Kaniko To Build And Push Images To ECR AWS From Gitlab Ci</h1> </span> </div> </header> <div class="page-content" itemprop="articleBody"> <h1 id="using-kaniko-to-build-and-push-images-to-ecr-aws-from-gitlab-ci"> <a href="#using-kaniko-to-build-and-push-images-to-ecr-aws-from-gitlab-ci" class="anchor-head"></a> Using Kaniko To Build And Push Images To ECR AWS From Gitlab Ci </h1> <p>In this guide, we will walk through the steps of using Kaniko to build and push Docker images to AWS Elastic Container Registry (ECR) from GitLab CI. Kaniko is a tool that allows building Docker images without requiring a Docker daemon, which makes it perfect for building images in a CI/CD pipeline. We will also set up an AWS ECR repository and push the built image to it.</p> <h3 id="prerequisites"> <a href="#prerequisites" class="anchor-head"></a> Prerequisites </h3> <p>Before we begin, make sure you have the following:</p> <ul> <li>A GitLab account with admin access to the repository</li> <li>An AWS account with admin access to ECR</li> </ul> <h3 id="step-1-setting-up-aws-ecr"> <a href="#step-1-setting-up-aws-ecr" class="anchor-head"></a> Step 1: Setting up AWS ECR </h3> <p>First, let’s create an ECR repository to store our Docker images.</p> <ol> <li>Navigate to the AWS Management Console and search for “ECR” in the search bar.</li> <li>Click “Create repository” to create a new repository. Give it a name and leave the other settings as default.</li> <li>Once the repository is created, click on it to view its details. Make a note of the repository URI, as we will need it later.</li> </ol> <h3 id="step-2-configuring-gitlab-ci"> <a href="#step-2-configuring-gitlab-ci" class="anchor-head"></a> Step 2: Configuring GitLab CI </h3> <p>Next, we need to add the necessary configuration to our GitLab CI file to build and push the Docker image to ECR using Kaniko.</p> <ol> <li>Create a <code class="language-plaintext highlighter-rouge">.gitlab-ci.yml</code> file in the root of your repository.</li> <li>Add the following code to the file:</li> </ol> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>image: gcr.io/kaniko-project/executor:latest

variables:
  DOCKER_REGISTRY: &lt;your-aws-account-id&gt;.dkr.ecr.&lt;your-region&gt;.amazonaws.com
  IMAGE_NAME: &lt;your-ecr-repository-name&gt;
  IMAGE_TAG: $CI_COMMIT_SHA

before_script:
  - echo "{\\"auths\\":{\\"$DOCKER_REGISTRY\\":{\\"auth\\":\\"$(echo -n $AWS_ACCESS_KEY_ID:$AWS_SECRET_ACCESS_KEY | base64)\\"}}}" &gt; /kaniko/.docker/config.json
  - echo "{\\"credHelpers\\":{\\"$DOCKER_REGISTRY\\":\\"ecr-login\\"}}" &gt; /kaniko/.docker/config.json
  - export AWS_REGION=&lt;your-region&gt;

build:
  script:
    - /kaniko/executor --context $CI_PROJECT_DIR --dockerfile $CI_PROJECT_DIR/Dockerfile --destination $DOCKER_REGISTRY/$IMAGE_NAME:$IMAGE_TAG --cache=true
  tags:
    - docker

</code></pre></div></div> <p>Make sure to replace <code class="language-plaintext highlighter-rouge">&lt;your-aws-account-id&gt;</code>, <code class="language-plaintext highlighter-rouge">&lt;your-region&gt;</code>, and <code class="language-plaintext highlighter-rouge">&lt;your-ecr-repository-name&gt;</code> with your own values.</p> <h3 id="step-3-pushing-the-docker-image-to-ecr"> <a href="#step-3-pushing-the-docker-image-to-ecr" class="anchor-head"></a> Step 3: Pushing the Docker Image to ECR </h3> <p>With the GitLab CI configuration in place, we can now push the Docker image to ECR.</p> <ol> <li>Add, commit, and push your code changes to the GitLab repository.</li> <li>Wait for the pipeline to run and complete.</li> <li>Navigate to your AWS ECR repository and verify that the Docker image has been pushed successfully.</li> </ol> <p>Congratulations! You have successfully used Kaniko to build and push Docker images to AWS ECR from GitLab CI. This will enable you to automate your build and deployment process, and ensure that your Docker images are always up-to-date and available to your team.</p> </div> </article> </main> <footer class="footer"> <a class="footer_item" href="/thanks">ack.</a> <a class="footer_item" href="javascript::void(0)">resume</a> <a class="footer_item" href="/feed.xml">rss</a> <span class="footer_item">&copy; 2023</span> <small class="footer_copyright"> <!-- Klisé Theme: https://github.com/piharpi/jekyll-klise --> <a href="https://github.com/piharpi/jekyll-klise" target="_blank" rel="noreferrer noopener" >klisé</a > theme on <a href="https://jekyllrb.com" target="_blank" rel="noreferrer noopener" >jekyll</a > </small> </footer> <script src="/assets/js/main.js" defer="defer"></script> </div> </body> </html>
